# -- Settings for the innago-webapp.
innago-webapp:
  # -- A name to override the generated name of the kubernetes objects.
  fullnameOverride: &name innago-vault-k8s-role-operator

  # -- Liveness and readiness probe settings.
  # See https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/
  health:
    # -- Liveness probe settings.
    livenessProbe:
      httpGet: &health
        # -- The path for the health probe.
        path: /healthz
        # -- The port for the health probe.
        port: http
    # -- Readiness probe settings.
    readinessProbe:
      httpGet: *health

  # -- Pod Disruption Budget settings.
  # See https://kubernetes.io/docs/concepts/workloads/pods/disruptions/#pod-disruption-budgets
  podDisruptionBudget:
    # -- If true, a PodDisruptionBudget will not be created.
    disabled: false
    # -- The minimum number of pods that must be available after an eviction.
    minAvailable: 0
    # -- The maximum number of pods that can be unavailable after an eviction.
    maxUnavailable: 1
    # -- The policy for evicting unhealthy pods.
    unhealthyPodEvictionPolicy: IfHealthyBudget

  # -- Topology spread constraints settings.
  # See https://kubernetes.io/docs/concepts/scheduling-eviction/topology-spread-constraints/
  topologySpreadConstraints:
    # -- If true, topology spread constraints will not be applied.
    disabled: false
    # -- The maximum skew between topologies.
    maxSkew: 1
    # -- The key for topology domain.
    topologyKey: kubernetes.io/hostname
    # -- What to do when a pod doesn't satisfy the spread constraint.
    whenUnsatisfiable: ScheduleAnyway

  # -- Image settings.
  image:
    # -- The repository for the application image.
    repository: ghcr.io/innago-property-management/innago-vault-k8s-role-operator
    # -- The tag for the application image.
    tag: &tag 1.0.0

  # -- Annotations to add to the primary pod
  podAnnotations:
    # -- vault address
    vault.security.banzaicloud.io/vault-addr: https://vault.default.svc:8200
    # -- name of the secret containing the vault TLS certificate
    # recommendation: use something like
    # https://github.com/emberstack/kubernetes-reflector
    # to replicate the secret into all namespaces
    vault.security.banzaicloud.io/vault-tls-secret: vault-tls
    keptn.sh/workload: *name
    keptn.sh/version: *tag
    keptn.sh/app: *name

  # -- security context
  # see https://kubernetes.io/docs/tasks/configure-pod-container/security-context/
  containerSecurityContext:
    runAsUser: 10001
    runAsGroup: 10001
    allowPrivilegeEscalation: false
    runAsNonRoot: true
    seccompProfile:
      type: RuntimeDefault
    capabilities:
      drop:
        - ALL

  # -- http container port
  httpContainerPort: 8080

  innagoVaultK8sRoleOperator:
    use: false

# -- Service account settings.
serviceAccount:
  # -- The name of the service account to use.
  name: *name
  # -- If true, a service account will be created.
  create: true
  # -- Annotations to add to the service account.
  annotations:
    app: *name
    app.kubernetes.io/name: *name

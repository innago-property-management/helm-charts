# -- Settings for the innago-webapp.
innago-webapp:
  # -- A name to override the generated name of the kubernetes objects.
  fullnameOverride: &name innago-vault-k8s-role-operator

  # -- Liveness and readiness probe settings.
  # See https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/
  health:
    # -- Startup probe settings (operators need time for leader election).
    startupProbe:
      httpGet: &health
        # -- The path for the health probe.
        path: /healthz
        # -- The port for the health probe.
        port: http
      # -- Initial delay before first check (seconds).
      initialDelaySeconds: 10
      # -- How often to perform the probe (seconds).
      periodSeconds: 5
      # -- Timeout for the probe (seconds).
      timeoutSeconds: 3
      # -- Number of failures before pod is considered unhealthy.
      failureThreshold: 30
    # -- Liveness probe settings.
    livenessProbe:
      httpGet: *health
    # -- Readiness probe settings.
    readinessProbe:
      httpGet: *health

  # -- Pod Disruption Budget settings.
  # See https://kubernetes.io/docs/concepts/workloads/pods/disruptions/#pod-disruption-budgets
  podDisruptionBudget:
    # -- If true, a PodDisruptionBudget will not be created.
    disabled: false
    # -- The minimum number of pods that must be available after an eviction.
    # IMPORTANT: Set to 1 for production to ensure high availability during maintenance.
    # NOTE: Only set minAvailable OR maxUnavailable, not both.
    minAvailable: 1
    # -- The policy for evicting unhealthy pods.
    unhealthyPodEvictionPolicy: IfHealthyBudget

  # -- Topology spread constraints settings.
  # See https://kubernetes.io/docs/concepts/scheduling-eviction/topology-spread-constraints/
  topologySpreadConstraints:
    # -- If true, topology spread constraints will not be applied.
    disabled: false
    # -- The maximum skew between topologies.
    maxSkew: 1
    # -- The key for topology domain.
    topologyKey: kubernetes.io/hostname
    # -- What to do when a pod doesn't satisfy the spread constraint.
    whenUnsatisfiable: ScheduleAnyway

  # -- Image settings.
  image:
    # -- The repository for the application image.
    repository: ghcr.io/innago-property-management/innago-vault-k8s-role-operator
    # -- The tag for the application image.
    tag: &tag 2.0.0

  # -- Resource requests and limits for the operator.
  # CRITICAL: Prevents OOM kills and ensures stable operation.
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 256Mi

  # -- Vault configuration
  vault:
    # -- Vault server address (protocol://host:port)
    # IMPORTANT: Configure this for your environment. Default assumes Vault in 'security' namespace.
    address: https://vault.security.svc:8200
    # -- Name of the secret containing the Vault TLS certificate
    # Recommendation: Use https://github.com/emberstack/kubernetes-reflector
    # to replicate the secret into all namespaces
    tlsSecret: vault-tls

  # -- Annotations to add to the primary pod
  podAnnotations:
    # vault.security.banzaicloud.io/vault-addr is set via vault.address above
    vault.security.banzaicloud.io/vault-addr: https://vault.security.svc:8200
    # vault.security.banzaicloud.io/vault-tls-secret is set via vault.tlsSecret above
    vault.security.banzaicloud.io/vault-tls-secret: vault-tls
    keptn.sh/workload: *name
    keptn.sh/version: *tag
    keptn.sh/app: *name

  # -- security context
  # see https://kubernetes.io/docs/tasks/configure-pod-container/security-context/
  containerSecurityContext:
    runAsUser: 10001
    runAsGroup: 10001
    allowPrivilegeEscalation: false
    runAsNonRoot: true
    seccompProfile:
      type: RuntimeDefault
    capabilities:
      drop:
        - ALL

  # -- http container port
  httpContainerPort: 8080

  innagoVaultK8sRoleOperator:
    use: false

# -- Service account settings.
serviceAccount:
  # -- The name of the service account to use.
  name: *name
  # -- If true, a service account will be created.
  create: true
  # -- Annotations to add to the service account.
  annotations:
    app: *name
    app.kubernetes.io/name: *name
